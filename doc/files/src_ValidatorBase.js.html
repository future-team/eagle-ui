<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, minimal-ui" />
    <title>src/ValidatorBase.js - eagle-ui</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-smart" _assetsPath="../assets">
 <nav class="navbar navbar-inverse navbar-fixed-top custom-navbar" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <a class="navbar-brand mainlogo" href="">
             
            <img alt="eagle-ui" src="../assets/css/logo.png" title="eagle-ui">
            
                eagle-ui
          </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                 <ul class="nav navbar-nav">
                    
                    <li><a href="">主页</a>
                    </li>
                    
                    <li><a href="http://future-team.github.io/eagle-ui/examples/index.html">示例</a>
                    </li>
                    
                </ul>
               <div class="navbar-form navbar-right filterAPi" autocomplete="off">
                <input type="text" id='txtSearchAPI' class="form-control search-query" placeholder="Search for API" />
                 <ul id="filterList" class="filterItems dropdown-menu" role="menu"></ul>
                </div>
            </div>
        </div>
    </nav>
    <div id="sidebar">
    <h3>模块/类</h3>
        <div id="api-tabview-filter">
            <input id='txtSearch' type="search" class="form-control" placeholder="Type to filter Modules/Classes">
        </div>
        <dl id="sidebar_list">
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/form(表单).html">form(表单)</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/CheckboxGroup.html">CheckboxGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/RadioGroup.html">RadioGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Select.html">Select</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ValidatorPanel.html">ValidatorPanel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Button.html">Button</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ButtonGroup.html">ButtonGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Input.html">Input</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ValidatorWrapper.html">ValidatorWrapper</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/grid(布局).html">grid(布局)</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Row.html">Row</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Col.html">Col</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Grid.html">Grid</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/panel(面板).html">panel(面板)</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Panel.html">Panel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelContent.html">PanelContent</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelFooter.html">PanelFooter</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelHeader.html">PanelHeader</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/table(表格).html">table(表格)</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Column.html">Column</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Table.html">Table</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Td.html">Td</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Th.html">Th</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tr.html">Tr</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/ui.html">ui</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/imgSlider.html">imgSlider</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Label.html">Label</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Slider.html">Slider</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Calendar.html">Calendar</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/CalendarPanel.html">CalendarPanel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Crumb.html">Crumb</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/DateTimePicker.html">DateTimePicker</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Dialog.html">Dialog</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/LabelGroup.html">LabelGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Paging.html">Paging</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Star.html">Star</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Suggestion.html">Suggestion</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tab.html">Tab</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tabset.html">Tabset</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/TimePicker.html">TimePicker</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Toast.html">Toast</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tooltip.html">Tooltip</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/TooltipPanel.html">TooltipPanel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
        </dl>
    <div class="icon-sidebar-btn icon-sidebar-btn-open"><span class="glyphicon glyphicon-chevron-left"></span>收起</div>
</div>
   
    <div class="stdoc-content">
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <div class="page-header">
    <h1>src/ValidatorBase.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>
import React,{Component,PropTypes} from &#x27;react&#x27;;
import ClassNameMixin from &#x27;./utils/ClassNameMixin&#x27;;
import ReactDom from &#x27;react/lib/ReactDOM&#x27;;

/**
 * 表单验证组件对所有带有data-validate属性的子元素input输入框进行验证&lt;br /&gt;
 * &lt;!--表单元素初始化值请绑定上data-field=“fieldName”,fieldName对应数据字段名称--&gt;
 * rules属性提供的规则有&lt;br/&gt;
 * &lt;pre&gt;
 *     required：是否必填
 *     date：日期格式验证
 *     number：是否是有效的号码
 *     url：url规则验证
 *     dateISO：日期ISO验证
 *     digits：是否是数字
 *     equalTo：值对比
 *     minlength：最少输入
 *     maxlength：最大输入
 *     email：邮箱验证
 *     rangelength：字符大小需在某个区间之内
 *     min：输入的值需要大于等于此规则定义的值
 *     max：输入的值需要小于等于此规则定义的值
 *     range：一个区间取值范围
 *     自定义，比如rules:{
 *          checkbox:{
 *                required:true,
 *                //自定义规则
 *                isValueToNumber:{
 *                    text:&#x27;value值不是数字&#x27;,
 *                    rule:function(value){
 *                        return !isNaN(value-0);
 *                    }
 *                }
 *            }
 *       }
 *     会验证name为checkbox的输入控件。
 *     自定义的规则作为key、value配置，validator会依据rule方法返回的true或者false来决定是否提示text中的文案
 * &lt;/pre&gt;
 * @class ValidatorPanel
 * @module form(表单)
 * @extends Component
 * @constructor
 * @demo #/validate|validate.js
 * @show true
 * */
@ClassNameMixin
export default class ValidatorPanel extends Component {
    static propTypes = {
        //触发点，change blur  manual（手动）
        trigger:PropTypes.string,
        submitCallback:PropTypes.func,
        /**
         * 需要初始化的表单元素默认值(废弃)
         * @property values
         * @type Object
         * */
        values:PropTypes.object,
        /**
         * 每次验证时值被改变后都会被触发，会回传当前data-field字段、值和所有值对象
         * @property getValueCallback
         * @type Function
         * */
        getValueCallback:PropTypes.func
    };

    static defaultProps = {
        /**
         * 包装容器
         * @property componentTag
         * @type String
         * @default form
         * */
        componentTag: &#x27;form&#x27;,
        /**
         * 触发验证的事件集合
         * @property trigger
         * @type String
         * @default blur keyup focus click
         * */
        trigger:&#x27;blur keyup focus click&#x27;,
        /**
         * 默认规则提示文案
         * @property message
         * @type Object
         * @default
         *       required: &#x27;不能为空&#x27;,
         date: &#x27;请正确填写日期&#x27;,
         number: &#x27;请输入一个有效的号码&#x27;,
         url: &#x27;请输入一个有效的URL&#x27;,
         email: &#x27;请输入一个有效的电子邮件地址&#x27;,
         dateISO: &#x27;请输入一个有效的日期(ISO)&#x27;,
         digits: &#x27;请输入数字&#x27;,
         equalTo:&#x27;请再次输入相同的值。&#x27;,
         minlength: &#x27;请输入至少{0}字符&#x27;,
         maxlength: &#x27;请输入不超过{0}字符&#x27;,
         rangelength: &#x27;请输入一个值{0}和{1}字符之间&#x27;,
         min: &#x27;请输入一个值大于或等于{0}&#x27;,
         max: &#x27;请输入一个值小于或等于{0}&#x27;,
         range: &#x27;请输入一个值{0} - {1}&#x27;
         * */
        message:{
            required: &#x27;不能为空&#x27;,
            date: &#x27;请正确填写日期&#x27;,
            number: &#x27;请输入一个有效的号码&#x27;,
            url: &#x27;请输入一个有效的URL&#x27;,
            email: &#x27;请输入一个有效的电子邮件地址&#x27;,
            dateISO: &#x27;请输入一个有效的日期(ISO)&#x27;,
            digits: &#x27;请输入数字&#x27;,
            equalTo:&#x27;请再次输入相同的值。&#x27;,
            minlength: &#x27;请输入至少{0}字符&#x27;,
            maxlength: &#x27;请输入不超过{0}字符&#x27;,
            rangelength: &#x27;请输入一个值{0}和{1}字符之间&#x27;,
            min: &#x27;请输入一个值大于或等于{0}&#x27;,
            max: &#x27;请输入一个值小于或等于{0}&#x27;,
            range: &#x27;请输入一个值{0} - {1}&#x27;
        },
        initCallback:function(){},
        /**
         * 自定义在提交后的callback
         * @event submitCallback
         * @param {object} opt 表单数据结构
         */
        submitCallback:function(){
            return true;
        },
        /**
         * 自定义验证规则之外的其他逻辑
         * @event validateCallback
         * @param {object} opt 表单数据结构
         * */
        validateCallback:function(){
            return true;
        },
        /**
         * 提示框消失时间
         * @property timeout
         * @type Number
         * @default 3000
         * */
        timeout:3000,
        /**
         * 提交按钮id
         * @property submitElement
         * @type String
         * */
        submitElement:&#x27;&#x27;,
        /**
         * 是否增强文本框提示
         * @property shake
         * @type Boolean
         * @default true
         * */
        shake:true,
        /**
         * 规则验证
         * @property rules
         * @type Object
         * */
        rules:{},
        /**
         * 提示方位
         * @property direction
         * @type String
         * @default right
         * */
        direction:&#x27;right&#x27;,
        /**
         * 重新更新dom
         * @property update
         * @type String
         * @default +new Date()
         * */
        update:+new Date()
    };

    constructor(props, context) {
        super(props, context);

        this.elements = {};

        this.formName = &#x27;validate-form&#x27;;
        this.errorClass = this.getClassName(&#x27;validate-error&#x27;);
        this.init = true;
        this.update = this.props.update;

        this.isUpdate = false;

        this.vals={};
        this.valueLink = &#x27;data-field&#x27;;

        this.state = {
            message:&#x27;&#x27;,
            show:&#x27;&#x27;,
            fadeShow:&#x27;block&#x27;
        };
    }

    trim(str){
        return str.replace(/(^\s*)|(\s*$)/g,&quot;&quot;);
    }

    isArray(value){
        if (value instanceof Array ||
            (!(value instanceof Object) &amp;&amp;
            (Object.prototype.toString.call((value)) == &#x27;[object Array]&#x27;) ||
            typeof value.length == &#x27;number&#x27; &amp;&amp;
            typeof value.splice != &#x27;undefined&#x27; &amp;&amp;
            typeof value.propertyIsEnumerable != &#x27;undefined&#x27; &amp;&amp;
            !value.propertyIsEnumerable(&#x27;splice&#x27;)) ) {

            return true;
        }
        return false;
    }

    initVals(){
        let elms = this.elements,
            val = &#x27;&#x27;,
            name=null,
            vals= this.vals;

        let {values} = this.props;
        if(values){
            for(let element in elms){
                name = this.getField(element);
                val = values[name];
                if(val){
                    this.setValue(element,val);
                    vals[name] = val;
                }
            }
        }

    }

    optional(element) {
        let val = this.getValue(element );
        return !this.options.defaultRules.required.call( this, val, element );
    }

    required( value, element ) {

        if ( element.nodeName.toLowerCase() === &quot;select&quot; ) {
            let val = $( element ).val();
            return val &amp;&amp; val.length &gt; 0;
        }
        if ( this.checkable( element ) ) {
            return this.getLength( value, element ) &gt; 0;
        }
        return this.trim( value ).length &gt; 0;
    }

    date( value, element ) {
        return this.optional( element ) || !/Invalid|NaN/.test( new Date( value ).toString() );
    }

    number( value, element ) {
        return this.optional( element ) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test( value );
    }

    url( value, element ) {
        return this.optional( element ) ||
            /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;&#x27;\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;&#x27;\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;&#x27;\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;&#x27;\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;&#x27;\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test( value );
    }
    email( value, element ) {

        return this.optional( element ) || /^[a-zA-Z0-9.!#$%&amp;&#x27;*+\/=?^_&#x60;{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test( value );
    }
    dateISO( value, element ) {
        return this.optional( element ) || /^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test( value );
    }
    digits( value, element ) {
        return this.optional( element ) || /^\d+$/.test( value );
    }
    equalTo( value, element, param ) {
        let target = document.querySelectorAll(param);
        /*if ( this.onfocus ) {
         target.off( &quot;.validate-equalTo&quot; ).on( &quot;blur.validate-equalTo&quot;, function() {
         this.show();
         });
         }*/
        return this.optional( element ) || value === target[0].value;
    }
    minlength( value, element, param ) {
        let length = this.isArray( value ) ? value.length : this.getLength( value, element );
        return this.optional( element ) || length &gt;= param;
    }
    maxlength( value, element, param ) {
        let length = this.isArray( value ) ? value.length : this.getLength( value, element );
        return this.optional( element ) || length &lt;= param;
    }
    rangelength( value, element, param ) {
        let length = this.isArray( value ) ? value.length : this.getLength( value, element );
        return this.optional( element ) || ( length &gt;= param[ 0 ] &amp;&amp; length &lt;= param[ 1 ] );
    }
    min( value, element, param ) {
        return this.optional( element ) || value &gt;= param;
    }
    max( value, element, param ) {
        return this.optional( element ) || value &lt;= param;
    }
    range( value, element, param ) {
        return this.optional( element ) || ( value &gt;= param[ 0 ] &amp;&amp; value &lt;= param[ 1 ] );
    }

    //待改进
    optional(element) {
        let val = this.getValue(element );
        return !this.required.call( this, val, element );
    }
    //高亮
    highlight(element){
        if(!this.checkable(element)){
            this.addClass(element,this.errorClass);

            if(this.props.shake){

                this.addClass(element,&#x27;shake animated&#x27;);
                setTimeout(function(){
                    this.removeClass(element,&#x27;shake animated&#x27;);
                }.bind(this),1000 );
            }

        }

    }
    //取消高亮
    unhighlight(element){
        this.removeClass(element,this.errorClass);
    }

    checkable( element ) {
        return ( /radio|checkbox/i ).test( element.type );
    }

    getLength( value, element ) {
        switch ( element.nodeName.toLowerCase() ) {
            case &quot;select&quot;:
                return document.querySelectorAll( &quot;option:selected&quot;, element ).length;
            case &quot;input&quot;:
                if ( this.checkable( element ) ) {
                    return document.querySelectorAll(&quot;[name=&#x27;&quot; + element.name + &quot;&#x27;]:checked&quot; ).length;
                }
        }
        return value.length;
    }

    formatString(str, options){

        if(!options){
            return str;
        }

        return str.replace(/\{(.+?)\}/ig, function(match, key){
            let value = typeof(options) != &#x27;object&#x27;?options: options[key];
            return typeof value == &#x27;undefined&#x27; ? match : value;
        });
    }

    getValue(element){
        let val,
            type = element.type.toLowerCase();

        if ( type === &quot;radio&quot; || type === &quot;checkbox&quot; ) {
            let el = document.querySelectorAll( &#x60;input[name=&quot;${element.name}&quot;]:checked&#x60; );
            return el &amp;&amp; el.length&gt;0? el[0].value:&#x27;&#x27;;
        } else if ( type === &quot;number&quot; &amp;&amp; typeof element.validity !== &quot;undefined&quot; ) {
            return element.validity.badInput ? false : element.value;
        }

        val = element.value;
        if ( typeof val === &quot;string&quot; ) {
            return val.replace(/\r/g, &quot;&quot; );
        }
        return val;
    }

    setValue(element,val){

    }
    //循环验证单个input上的规则
    check(element){

        //从每一项中提取验证规则
        let {message} = this.props;
        //let options = extend(true,{},this.options );
        let val = this.getValue(element),
        //rule = null,
            msg = &#x27;&#x27;,
            text = null,
            rules = this.props.rules[element.name];//element.getAttribute(&#x27;data-rules&#x27;) ;


        /*{
         require:true,
         isName:function(){
         return true
         },
         number:{
         text:&#x27;不能为空&#x27;,
         params:1,
         rule:function(){
         return true;
         }
         }
         }*/
        this.vals[this.getField(element)]=val;
        for(let rule in rules){

            text = rules[rule];
            //text =typeof(text)!==&#x27;string&#x27; ? text : {text:text};
            if(typeof(text) == &#x27;boolean&#x27;){
                text = {};
            }
            if(!text.text){
                text.text = message[rule ];
            }

            let validate = text.rule &amp;&amp; text.rule instanceof  Function ? text.rule:this[rule];

            if(!validate.call(this,val,element,text.params ) ){
                msg = text.text;
                break;
            }
            /*if(text.url &amp;&amp; text.url!=&#x27;&#x27; ){
             msg = this.ajaxValidate(text.url,val,text.params);
             if(typeof(msg) !== &#x27;string&#x27;){
             msg = text.text;
             }
             break;
             }else if(!this[rule].call(this,val,element,text.params)  ){
             msg = text.text;
             break;
             }*/
        }
        return this.formatString(msg,(text &amp;&amp;text.params) || &#x27;&#x27;);
    }



    getField(element){
        let attr = element.getAttribute(this.valueLink);
        return attr ? attr : element.name;
    }

    validateHandler(e){
        let {getValueCallback} = this.props,target = e.target;

        clearTimeout(this.vaTimeout);
        this.vaTimeout = setTimeout(function(){
            let b = this.validate(target);
            b &amp;&amp; getValueCallback &amp;&amp;(getValueCallback(this.getField(target),this.getValue(target),this.vals ) );

        }.bind(this),400 );
    }

    submit(e){
        clearTimeout(this.__blurTimeobj);
        let elements = this.elements,
            element = null,
            isSubmit = true;
        if(!elements || elements.length&lt;=0 ){
            return false;
        }
        for(let item in elements){
            element = elements[item];//React.findDOMNode(this.props.refs[item] );
            if(element &amp;&amp; element.nodeType==1){
                if(!this.validate(element  ) ){
                    setTimeout(function(){
                        element.focus();
                    });
                    isSubmit = false;
                    break;
                }
            }
        }

        e.preventDefault();
        e.stopPropagation();
        if(isSubmit &amp;&amp; this.props.validateCallback(this.vals) ){
            return this.props.submitCallback &amp;&amp;(this.props.submitCallback(this.vals,e) );
        }
        return false;
    }

    //隐藏错误提示
    hide(){

    }
    parents (ele,str) {
        try {
            var tempNode = ele.parentNode;
            while (tempNode &amp;&amp; tempNode.tagName != arguments[0].toUpperCase()) {
                tempNode = tempNode.parentNode;
            }
            return [tempNode];
        } catch (err) {
            return [];
        }
    }

    getTip(){
        return this.form &amp;&amp; this.form.querySelector(&#x60;.${this.getClassName(&quot;validate-tips&quot;)}&#x60;);
    }
    //设置错误提示框的位置
    setTipsOffset(element){
        let node = null,
            name = element.name,
            d = this.props.direction,
            tb=d===&quot;bottom&quot; || d===&quot;top&quot;,
            tip =this.getTip(),
            tag = this.props.componentTag,
            w = element.offsetLeft,
            t = element.offsetTop,
            h = element.offsetHeight;

        while(element &amp;&amp; (element.nodeType!==1 || !this.hasClass(element, this.getClassName(&#x27;validate&#x27;))) ){
            element = element.parentNode;
        }

        if(element){
            element = element.querySelectorAll(&#x60;[name=&quot;${name}&quot;]&#x60;);

            element = element[tb ? 0:element.length-1];

            w = element.offsetLeft;
            t = element.offsetTop;
            node = element.offsetParent;

            while(node &amp;&amp; !this.hasClass(node,this.getClassName(&#x27;validate&#x27;))) {
                t+=node.offsetTop;
                w+=node.offsetLeft;
                node = node.offsetParent;

            }
            //w = tip.offsetWidth;
            this.highlight(element);

            tip.style.display=&quot;block&quot;;

            setTimeout(function(){
                if(tb){

                    tip.style.cssText=&#x60;left:${w}px;top:${(d===&quot;bottom&quot;?t+element.offsetHeight:t-tip.offsetHeight)}px;width:${element.offsetWidth}px&#x60;;
                }else{
                    //height:${h}px;line-height:${h}px;
                    tip.style.cssText = &#x60;left:${w+(d===&quot;right&quot;?element.offsetWidth+10:0)}px;top:${t+(element.offsetHeight/2-(tip.offsetHeight/2) )}px;&#x60;;
                }
            }.bind(this));
        }else{
            //tip.style.display=&#x27;none&#x27;;
        }

    }

    getForm(){
        return ReactDom.findDOMNode(this.refs[this.props.id?this.props.id:this.formName]);
    }
    getElements(){
        return this.form.querySelectorAll(&#x60;[data-validate]&#x60;);
    }

    setDomEvent(){
        let elements = this.getElements(),_this = this,{trigger,initCallback,submitElement} = this.props;
        for(let i=0,len=elements.length;i&lt;len;i++){
            trigger.split(&#x27; &#x27;).forEach((event)=&gt;{
                elements[i].removeEventListener(event,_this._fun,false);
                elements[i].addEventListener(event,_this._fun,false);
            });
        }

        this.elements = elements;
    }

    componentDidMount(){

        this._fun = function(e){
            this.validateHandler(e);
        }.bind(this);

        this.form = this.getForm();

        let elements = this.getElements(),_this = this,{trigger,initCallback,submitElement} = this.props;

        /*for(let i=0,len=elements.length;i&lt;len;i++){
         trigger.split(&#x27; &#x27;).forEach((event)=&gt;{

         elements[i].addEventListener(event,_this.validateHandler.bind(_this),false);
         });
         }*/

        this.setDomEvent();

        initCallback.call(this,this.submit.bind(this));

        if(submitElement){
            document.querySelector(submitElement).addEventListener(&#x27;click&#x27;,this.submit.bind(this),false);
        }
        //let tip = this.getTip();

        this.elements = elements;
        this.init = false;

    }

    componentDidUpdate(prevProps,prevState){
        if(this.props.update!=this.update){
            this.setDomEvent();

            this.update = this.props.update;
            this.isUpdate = true;
            this.setState({
                show:&#x27;&#x27;
            });
        }
    }


    removeFadeout(){
        clearTimeout(this.fadeoutTimeObj);
        this.fadeoutTimeObj=setTimeout(function(){
            if(!this.state.show &amp;&amp;!this.init &amp;&amp; this.state.fadeShow!=&#x27;none&#x27;){
                this.removeClass(this.getTip(),&#x27;fadeout&#x27;);

            }
        }.bind(this),400 );
    }

}
    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
<a id="gotoTop" class='well well-small' href='#'>
</a>
<script src="../assets/vendor/jquery/jquery-1.8.2.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/config.js"></script>
<script src="../assets/js/doc.js"></script>

</body>
</html>
